<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tyme Hall â€” Memory Phase Plots</title>
    <link rel="stylesheet" href="/panel/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #0b0d12;
            color: #eef;
            font-family: Arial, sans-serif;
            padding: 28px;
        }
        h1 { color: #9fe3ff; }
        .container {
            max-width: 1100px;
            margin: auto;
        }
        .status {
            margin: 16px 0;
            padding: 12px 16px;
            background: #11141a;
            border-radius: 8px;
        }
        canvas {
            margin-top: 30px;
            background: #11141a;
            border-radius: 12px;
            padding: 10px;
        }
    </style>
</head>
<body>
<div class="sidebar">
    <h2>Tyme Hall</h2>
    <a href="/panel/index.html">Overview</a>
    <a href="/panel/governance.html">Governance Summary</a>
    <a href="/panel/evolution.html">Evolution Graph</a>
    <a href="/panel/drift.html">Drift & Stability</a>
    <a href="/panel/heatmap.html">Architecture Heatmap</a>
    <a href="/panel/phase.html" class="active">Phase Plots</a>
    <a href="/panel/simulation.html">Harmonic Simulation</a>
</div>

<div class="content">
    <div class="container">
        <h1>Memory Phase Plot</h1>
        <p>Dimensionality-reduced embeddings (PCA) showing the evolutionary trajectory of Tyme's memory space.</p>
        <div id="status" class="status">Loading phase data...</div>
        <div id="attractor" class="status">Loading attractor forecast...</div>
        <div id="basin" class="status">Loading stability basin...</div>
        <canvas id="phaseChart" height="420"></canvas>
        <p style="margin-top: 20px; color: #b8c2d1;">Each point represents an architecture version projected onto the first two principal components of its embedding vector.</p>
    </div>
</div>

<script>
async function loadPhase() {
    const statusEl = document.getElementById('status');
    try {
        const res = await fetch('/governance/phase.json');
        const data = await res.json();

        if (data.error) {
            statusEl.textContent = data.error;
            return;
        }

        statusEl.textContent = `Phase data generated at ${data.path}`;
        const points = (data.points || []).map(p => ({ x: p.x, y: p.y, version: p.version }));

        const ctx = document.getElementById('phaseChart').getContext('2d');
        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Phase Coordinates',
                    data: points,
                    backgroundColor: '#49c6ff',
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: 'Principal Component 1', color: '#b8c2d1' }, grid: { color: '#1c2230' } },
                    y: { title: { display: true, text: 'Principal Component 2', color: '#b8c2d1' }, grid: { color: '#1c2230' } }
                },
                plugins: {
                    legend: { labels: { color: '#eef' } },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `v${ctx.raw.version}: (${ctx.raw.x.toFixed(3)}, ${ctx.raw.y.toFixed(3)})`
                        }
                    }
                }
            }
        });
    } catch (err) {
        statusEl.textContent = 'Failed to load phase data.';
        console.error(err);
    }
}

async function loadAttractor() {
    const attrEl = document.getElementById('attractor');
    try {
        const res = await fetch('/governance/attractor.json');
        const data = await res.json();

        if (data.error) {
            attrEl.textContent = data.error;
            return;
        }

        const info = data.attractor || {};
        const type = info.type || 'unknown';
        const strength = info.strength !== undefined ? info.strength : 'n/a';
        const version = data.version ? `v${data.version}` : 'latest';

        attrEl.innerHTML = `Attractor ${version}: <strong>${type}</strong> (strength ${strength})`;
        if (data.path) {
            attrEl.innerHTML += `<br><small>Map saved to ${data.path}</small>`;
        }
    } catch (err) {
        attrEl.textContent = 'Failed to load attractor data.';
        console.error(err);
    }
}

async function loadBasin() {
    const basinEl = document.getElementById('basin');
    try {
        const res = await fetch('/governance/basin.json');
        const data = await res.json();

        if (data.error) {
            basinEl.textContent = data.error;
            return;
        }

        const cls = data.class || 'unknown';
        const depth = data.basin_depth ?? 'n/a';
        const width = data.basin_width ?? 'n/a';
        const escapeEnergy = data.escape_energy ?? 'n/a';
        const curvature = data.curvature ?? 'n/a';
        const path = data.path ? `<br><small>Map saved to ${data.path}</small>` : '';

        basinEl.innerHTML = `Stability Basin: <strong>${cls}</strong><br>` +
            `Depth ${depth}, Width ${width}, Escape Energy ${escapeEnergy}, Curvature ${curvature}${path}`;
    } catch (err) {
        basinEl.textContent = 'Failed to load stability basin data.';
        console.error(err);
    }
}

loadPhase();
loadAttractor();
loadBasin();
</script>
</body>
</html>
