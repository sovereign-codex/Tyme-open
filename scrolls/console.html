<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tyme Console</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>

<div class="tyme-header">
  <div class="tyme-header-inner">
    <div class="tyme-sigil">⧈</div>
    <div>
      <div class="tyme-title">CONSOLE</div>
      <div class="tyme-subtitle">TYME COMMAND CHAMBER</div>
    </div>
  </div>
</div>

<div id="console-container">
  <input id="inputBox" class="console-input" placeholder="Speak to Tyme…">
  <div class="presence-indicator" id="presence-indicator">Mode: NATURAL</div>
  <div id="output" class="console-output"></div>
</div>

<script>
async function sendCommand(text) {
  const out = document.getElementById("output");
  const presence = document.getElementById("presence-indicator");

  try {
    const response = await fetch("/cms/execute", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await response.json();

    let modeLabel = (data.mode || "natural").toUpperCase();
    presence.textContent = "Mode: " + modeLabel;

    out.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    presence.textContent = "Mode: ERROR";
    out.textContent = "Error contacting backend: " + e;
  }
}

document.getElementById("inputBox").addEventListener("keydown", evt => {
  if (evt.key === "Enter") {
    const text = evt.target.value.trim();
    if (text) sendCommand(text);
    evt.target.value = "";
  }
});
</script>

</body>
</html>
